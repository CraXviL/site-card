$(document).ready(function () {
	'use strict';

	$('.navbar-nav a').on('click', function (e) {
		e.preventDefault();
		var target = e.target.getAttribute('href');
		var crtOffset = window.pageYOffset;
		var trgOffset = $(target).offset().top;
		var t = Math.abs(crtOffset - trgOffset) / 5;
		$('html, body').animate({ scrollTop: trgOffset - trgOffset / 20 }, t, 'linear');
	});

	$('#block-portfolio ul a').on('click', function (e) {
		e.preventDefault();
		$('#portfolio-modal').show().animate({ right: '10%' });
		switch (e.target.id) {
			case 'geometriadizaina':
				$('#portfolio-modal h2').text('Лэндинг для дизайнеров интерьера "ГЕОМЕТРИЯ ДИЗАЙНА"');
				$('#design').attr('href', 'https://yadi.sk/d/DLXXxglkN_Bjjw');
				$('#code').attr('href', 'https://github.com/CraXviL/geometriadizaina.ru');
				$('#webPage').attr('href', 'http://geometriadizaina.ru');
				break;
			case 'prazdnikmne':
				$('#portfolio-modal h2').text('Многостраничный сайт "КОРПОРАЦИЯ ПРАЗДНИКОВ АНАСТАСИИ БАЖЕНОВОЙ"');
				$('#design').attr('href', 'https://yadi.sk/d/oo_e28SAj-_fTg');
				$('#code').attr('href', 'https://github.com/CraXviL/prazdnikmne.ru');
				$('#webPage').attr('href', 'https://prazdnikmne.ru');
				break;
			case 'plita':
				$('#portfolio-modal h2').text('Лэндинг ресторана "PLITA"');
				$('#design').attr('href', 'https://yadi.sk/d/jA22yCzpNXJ1Tg');
				$('#code').attr('href', 'https://github.com/CraXviL/plita');
				$('#webPage').attr('href', 'https://plitarest.ru');
				break;
		}
	});

	/* form sending */

	var inputsList = {
		name: {
			pattern: /^[ а-яё]{2,}$/gi,
			valid: false
		},
		tel: {
			pattern: /^((8|\+7)[- ]?)?(\(?\d{3}\)?[- ]?)?[\d- ]{7,10}$/,
			valid: false
		},
		email: {
			pattern: /^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/,
			valid: false
		}
	};

	(function () {
		var _loop = function _loop(elem) {
			$('input[name="' + elem + '"]').on('input', function () {
				return runValidate([elem]);
			});
		};

		for (var elem in inputsList) {
			_loop(elem);
		}
	})();

	function runValidate(inputName) {
		inputName.forEach(function (inputName) {
			var pattern = inputsList[inputName].pattern;
			var $target = $('input[name="' + inputName + '"]');
			var value = $target.val().trim();
			inputsList[inputName].valid = pattern.test(value);
			var error = !inputsList[inputName].valid;
			showError($target, error);
		});
	}

	function showError($target, error) {
		if (error) {
			$target.addClass('error');
			$target.removeClass('valid');
		} else {
			$target.removeClass('error');
			$target.addClass('valid');
		}
	}

	$('form').submit(function (e) {
		e.preventDefault();
		var inputCnt = 0,
		    validCnt = 0;
		for (var elem in inputsList) {
			inputCnt++;
			validCnt += inputsList[elem].valid ? 1 : 0;
		}
		if (validCnt === inputCnt) {
			$.ajax({
				url: 'sendmail.php',
				type: 'POST',
				data: $('form').serialize(),
				success: function success() {
					console.log('Запрос отправлен');
				},
				error: function error() {
					console.log('Возникла ошибка при отправке');
				}
			});
			$('form').fadeOut();
			window.setTimeout(function () {
				$('form').html('<h2>Отправлено!</h2><p>Я с Вами обязательно свяжусь</p>');
				$('form').fadeIn();
			}, 500);
		} else {
			runValidate(['name', 'tel', 'email']);
		}
	});
});